<?php
defined('BASEPATH') or exit('No direct script access allowed');

if (!function_exists('set_value')) {
	/**
	 * Form Value
	 *
	 * Grabs a value from the POST array or old form value for the specified field so you can
	 * re-populate an input field or textarea. If Form Validation
	 * is active it retrieves the info from the validation class
	 *
	 * @param string $field Field name
	 * @param string $default Default value
	 * @param bool $html_escape Whether to escape HTML special characters or not
	 * @return string
	 */
	function set_value($field, $default = '', $html_escape = TRUE)
	{
		$CI = &get_instance();

		$value = (isset($CI->form_validation) && is_object($CI->form_validation) && $CI->form_validation->has_rule($field))
			? $CI->form_validation->set_value($field, $default)
			: $CI->input->old($field, FALSE);

		isset($value) or $value = $default;
		return ($html_escape) ? html_escape($value) : $value;
	}
}

if (!function_exists('set_select')) {
	/**
	 * Set Select
	 *
	 * Let's you set the selected value of a <select> menu via data in the POST array or old form value.
	 * If Form Validation is active it retrieves the info from the validation class
	 *
	 * @param	string
	 * @param	string
	 * @param	bool
	 * @return	string
	 */
	function set_select($field, $value = '', $default = FALSE)
	{
		$CI = &get_instance();

		if (isset($CI->form_validation) && is_object($CI->form_validation) && $CI->form_validation->has_rule($field)) {
			return $CI->form_validation->set_select($field, $value, $default);
		} elseif (($input = $CI->input->old($field, FALSE)) === NULL) {
			return ($default === TRUE) ? ' selected="selected"' : '';
		}

		$value = (string) $value;
		if (is_array($input)) {
			// Note: in_array('', array(0)) returns TRUE, do not use it
			foreach ($input as &$v) {
				if ($value === $v) {
					return ' selected="selected"';
				}
			}

			return '';
		}

		return ($input === $value) ? ' selected="selected"' : '';
	}
}

if (!function_exists('set_checkbox')) {
	/**
	 * Set Checkbox
	 *
	 * Let's you set the selected value of a checkbox via the value in the POST array or old form value.
	 * If Form Validation is active it retrieves the info from the validation class
	 *
	 * @param	string
	 * @param	string
	 * @param	bool
	 * @return	string
	 */
	function set_checkbox($field, $value = '', $default = FALSE)
	{
		$CI = &get_instance();

		if (isset($CI->form_validation) && is_object($CI->form_validation) && $CI->form_validation->has_rule($field)) {
			return $CI->form_validation->set_checkbox($field, $value, $default);
		}

		// Form inputs are always strings ...
		$value = (string) $value;
		$input = $CI->input->old($field, FALSE);

		if (is_array($input)) {
			// Note: in_array('', array(0)) returns TRUE, do not use it
			foreach ($input as &$v) {
				if ($value === $v) {
					return ' checked="checked"';
				}
			}

			return '';
		}

		// Unchecked checkbox and radio inputs are not even submitted by browsers ...
		if ($CI->input->method() === 'post' || $CI->input->is_validation_redirect()) {
			return ($input === $value) ? ' checked="checked"' : '';
		}

		return ($default === TRUE) ? ' checked="checked"' : '';
	}
}

// ------------------------------------------------------------------------

if (!function_exists('set_radio')) {
	/**
	 * Set Radio
	 *
	 * Let's you set the selected value of a radio field via info in the POST array or old form value.
	 * If Form Validation is active it retrieves the info from the validation class
	 *
	 * @param	string	$field
	 * @param	string	$value
	 * @param	bool	$default
	 * @return	string
	 */
	function set_radio($field, $value = '', $default = FALSE)
	{
		$CI = &get_instance();

		if (isset($CI->form_validation) && is_object($CI->form_validation) && $CI->form_validation->has_rule($field)) {
			return $CI->form_validation->set_radio($field, $value, $default);
		}

		// Form inputs are always strings ...
		$value = (string) $value;
		$input = $CI->input->old($field, FALSE);

		if (is_array($input)) {
			// Note: in_array('', array(0)) returns TRUE, do not use it
			foreach ($input as &$v) {
				if ($value === $v) {
					return ' checked="checked"';
				}
			}

			return '';
		}

		// Unchecked checkbox and radio inputs are not even submitted by browsers ...
		if ($CI->input->method() === 'post' || $CI->input->is_validation_redirect()) {
			return ($input === $value) ? ' checked="checked"' : '';
		}

		return ($default === TRUE) ? ' checked="checked"' : '';
	}
}
